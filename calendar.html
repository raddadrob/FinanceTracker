<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - Cockrum Finances</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #333;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        h1, h2 {
            text-align: center;
            color: #0f0;
        }
        .menu-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .menu-links {
            display: flex;
            gap: 15px;
        }
        .menu-bar a {
            color: #0f0;
            text-decoration: none;
            padding: 10px 20px;
            background: #444;
            border-radius: 4px;
        }
        .menu-bar a:hover {
            background: #0c0;
        }
        .menu-buttons {
            display: flex;
            gap: 10px;
        }
        .logoff-button, .theme-button {
            background: #0f0;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .logoff-button:hover, .theme-button:hover {
            background: #0c0;
        }
        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .month-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .month-buttons button {
            background: #444;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .month-buttons button:hover {
            background: #0c0;
        }
        .month-buttons button.active {
            background: #0f0;
            color: #000;
        }
        .month-year {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.5em;
            color: #0f0;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        .day {
            background: #444;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .day header {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .day input[type="number"] {
            width: 100%;
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #222;
            color: #fff;
        }
        .cash-balance {
            margin-top: 10px;
            font-weight: bold;
        }
        .ending-balance {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .initial-cash-balance {
            text-align: center;
            margin-bottom: 10px;
        }
        .initial-cash-balance input {
            padding: 5px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #222;
            color: #fff;
        }
        .days-of-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 10px;
        }
        .days-of-week div {
            font-weight: bold;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDy0PPpo6xMukyahC4DBCQ_ILJNROdvPWM",
            authDomain: "cockrumfinance.firebaseapp.com",
            projectId: "cockrumfinance",
            storageBucket: "cockrumfinance.appspot.com",
            messagingSenderId: "446623626941",
            appId: "1:446623626941:web:3dc1d2e435caf61d04e9d4",
            measurementId: "G-JFRC4K0BBF"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let initialCashBalance = 0;

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadInitialCashBalance();
                renderCalendar();
            } else {
                window.location.href = 'login.html';
            }
        });

        async function loadInitialCashBalance() {
            const doc = await db.collection('users').doc(currentUser.uid).collection('cash_flow').doc(`${currentYear}-${currentMonth}`).get();
            if (doc.exists) {
                initialCashBalance = doc.data().initialCashBalance || 0;
            } else {
                initialCashBalance = 0;
            }
            document.getElementById('initial-cash-balance').value = initialCashBalance.toLocaleString('en-US', { style: 'currency', currency: 'USD' }).replace('$', '');
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYearLabel = document.getElementById('month-year');
            calendar.innerHTML = '';
            monthYearLabel.innerText = `${monthNames[currentMonth]} ${currentYear}`;

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            // Render empty days before the start of the month
            for (let i = 0; i < firstDayOfMonth; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('day');
                calendar.appendChild(emptyDay);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('day');
                dayDiv.innerHTML = `
                    <header>${day}</header>
                    <input type="number" class="credit" placeholder="Credit" onblur="updateCashFlow(${day})">
                    <input type="number" class="debit" placeholder="Debit" onblur="updateCashFlow(${day})">
                    <div class="cash-balance" id="cash-${day}">Cash: $0</div>
                `;
                calendar.appendChild(dayDiv);
            }

            loadCashFlow();
        }

        async function loadCashFlow() {
            const snapshot = await db.collection('users').doc(currentUser
            .uid).collection('cash_flow').doc(`${currentYear}-${currentMonth}`).get();
            if (snapshot.exists) {
                const data = snapshot.data();
                for (let day = 1; day <= 31; day++) {
                    const creditInput = document.querySelector(`.day:nth-child(${day + new Date(currentYear, currentMonth, 1).getDay()}) .credit`);
                    const debitInput = document.querySelector(`.day:nth-child(${day + new Date(currentYear, currentMonth, 1).getDay()}) .debit`);
                    const cashBalanceDiv = document.getElementById(`cash-${day}`);
                    if (data[day]) {
                        creditInput.value = data[day].credit || '';
                        debitInput.value = data[day].debit || '';
                        cashBalanceDiv.innerText = `Cash: $${formatNumber(data[day].cash)}`;
                    }
                }
                updateCashBalances();
            }
        }

        function formatNumber(value) {
            return parseFloat(value).toLocaleString('en-US', { style: 'currency', currency: 'USD' }).replace('$', '');
        }

        async function updateCashFlow(day) {
            const creditInput = document.querySelector(`.day:nth-child(${day + new Date(currentYear, currentMonth, 1).getDay()}) .credit`);
            const debitInput = document.querySelector(`.day:nth-child(${day + new Date(currentYear, currentMonth, 1).getDay()}) .debit`);
            const credit = parseFloat(creditInput.value) || 0;
            const debit = parseFloat(debitInput.value) || 0;

            const cashBalance = initialCashBalance + credit - debit;
            const cashBalanceDiv = document.getElementById(`cash-${day}`);
            cashBalanceDiv.innerText = `Cash: $${formatNumber(cashBalance)}`;

            const docRef = db.collection('users').doc(currentUser.uid).collection('cash_flow').doc(`${currentYear}-${currentMonth}`);
            const doc = await docRef.get();
            if (doc.exists) {
                const data = doc.data();
                data[day] = { credit, debit, cash: cashBalance };
                await docRef.update(data);
            } else {
                const data = { [day]: { credit, debit, cash: cashBalance } };
                await docRef.set(data);
            }

            updateCashBalances();
        }

        function updateCashBalances() {
            const days = document.querySelectorAll('.day');
            let previousCash = initialCashBalance;
            days.forEach((dayDiv, index) => {
                const creditInput = dayDiv.querySelector('.credit');
                const debitInput = dayDiv.querySelector('.debit');
                const cashBalanceDiv = dayDiv.querySelector('.cash-balance');

                const credit = parseFloat(creditInput.value) || 0;
                const debit = parseFloat(debitInput.value) || 0;
                const cash = previousCash + credit - debit;

                cashBalanceDiv.innerText = `Cash: $${formatNumber(cash)}`;
                previousCash = cash;
            });

            document.getElementById('ending-balance').innerText = `Ending Balance: $${formatNumber(previousCash)}`;
        }

        function setMonth(month) {
            currentMonth = month;
            loadInitialCashBalance();
            renderCalendar();
        }

        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-theme');
        }
    </script>
</head>
<body>
    <div id="calendar-container" class="container">
        <h1>Cockrum Finances</h1>
        <div class="menu-bar">
            <div class="menu-links">
                <a href="index.html">Summary</a>
                <a href="details.html">View Details</a>
                <a href="calendar.html">Calendar</a>
            </div>
            <div class="menu-buttons">
                <button class="theme-button" onclick="toggleTheme()">Theme</button>
                <button class="logoff-button" onclick="logOff()">Log Off</button>
            </div>
        </div>
        <div class="month-navigation">
            <div class="month-buttons">
                ${monthNames.map((month, index) => `<button onclick="setMonth(${index})" class="${index === currentMonth ? 'active' : ''}">${month}</button>`).join('')}
            </div>
        </div>
        <div class="initial-cash-balance">
            Initial Cash Balance: <input type="number" id="initial-cash-balance" onblur="updateCashFlow(0)" placeholder="Enter initial cash balance">
        </div>
        <div id="month-year" class="month-year"></div>
        <div class="days-of-week">
            ${daysOfWeek.map(day => `<div>${day}</div>`).join('')}
        </div>
        <div id="calendar" class="calendar"></div>
        <div id="ending-balance" class="ending-balance"></div>
    </div>
</body>
</html>












